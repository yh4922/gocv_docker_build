  FROM golang:1.19-buster 
  LABEL maintainer="hybridgroup"

  RUN apt-get update && apt-get install -y --no-install-recommends \
        git build-essential cmake pkg-config unzip libgtk2.0-dev \
        curl ca-certificates libcurl4-openssl-dev libssl-dev \
        libavcodec-dev libavformat-dev libswscale-dev libtbb2 libtbb-dev \
        libjpeg62-dev libpng-dev libtiff-dev libdc1394-22-dev && \
        rm -rf /var/lib/apt/lists/*

  ARG OPENCV_VERSION="4.7.0"
  ENV OPENCV_VERSION $OPENCV_VERSION

  ARG OPENCV_FILE="https://github.com/opencv/opencv/archive/${OPENCV_VERSION}.zip"
  ENV OPENCV_FILE $OPENCV_FILE

  ARG OPENCV_CONTRIB_FILE="https://github.com/opencv/opencv_contrib/archive/${OPENCV_VERSION}.zip"
  ENV OPENCV_CONTRIB_FILE $OPENCV_CONTRIB_FILE

  RUN curl -Lo opencv.zip ${OPENCV_FILE} && \
        unzip -q opencv.zip && \
        curl -Lo opencv_contrib.zip ${OPENCV_CONTRIB_FILE} && \
        unzip -q opencv_contrib.zip && \
        rm opencv.zip opencv_contrib.zip

  RUN cd opencv-${OPENCV_VERSION} && \
        mkdir build && cd build && \
        cmake -D CMAKE_BUILD_TYPE=RELEASE \
        -D CMAKE_INSTALL_PREFIX=/usr/local \
        -D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib-${OPENCV_VERSION}/modules \
        -D BUILD_SHARED_LIBS=OFF \
        -D ENABLE_NEON=ON \
        -D WITH_FFMPEG=ON \
        -D WITH_TBB=ON \
        -D BUILD_TBB=ON \
        -D BUILD_TESTS=OFF \
        -D WITH_EIGEN=OFF \
        -D WITH_GSTREAMER=OFF \
        -D WITH_V4L=ON \
        -D WITH_LIBV4L=ON \
        -D WITH_VTK=OFF \
        -D WITH_QT=OFF \
        -D BUILD_JPEG=ON \
        -D OPENCV_ENABLE_NONFREE=ON \
        -D BUILD_DOCS=OFF \
        -D BUILD_EXAMPLES=OFF \
        -D BUILD_TESTS=OFF \
        -D BUILD_PERF_TESTS=OFF \
        -D BUILD_opencv_java=NO \
        -D BUILD_opencv_python=NO \
        -D BUILD_opencv_python2=NO \
        -D BUILD_opencv_python3=NO \
        -D OPENCV_GENERATE_PKGCONFIG=ON .. && \
        make -j $(nproc --all) && \
        make preinstall && make install && ldconfig && \
        cd / && rm -rf opencv*